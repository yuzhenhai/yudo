var JLAMP=JLAMP||{};(function(b){var a=function(){this.version="2017.3.001";this.modalType={popBase:0,popDept:1,popEmp:2,popOne:3,popTree:4,popZip:5};this.defaults={id:"",object:"",bizCompID:"",valueCheck:true,modalType:this.modalType.popBase,popupTitle:"",firstVal:"",disabled:false,codeVal:"",nameVal:"",codeOnly:false,nameOnly:false,jlampUUID:""};this.$parent=null;this.callback="";this.isCallbackCalled=false;this.isClicked=false};a.prototype.makeAll=function(){var c=this;b.each(b("div[name='appContainer'][style!='display: none;'] input[jlamp-pop]:not(input[jlamp-popcode],input[jlamp-pop]:not(input[jlamp-popcode])"),function(d){var e=b(this);c.make(e.attr("id"))})};a.prototype.make=function(c){var g=b("#"+c);var d=g.attr("bizcomponentid");var e=g.attr("jlamp-pop-valcheck");var l=g.attr("jlamp-pop-modaltype");var h=g.attr("jlamp-pop-title");var i=g.attr("jlamp-pop-firstval");var f=g.attr("disabled");var k=g.attr("jlamp-pop-codeval");var j=g.attr("jlamp-pop-nameval");if(e){if(e.toString().toLowerCase()=="y"||e.toString().toLowerCase()=="true"){e=true}else{e=false}}else{g.attr("jlamp-pop-valcheck",this.defaults.valueCheck);e=this.defaults.valueCheck}if(!l){l=this.modalType.popBase}if(f){f=true}else{f=this.defaults.disabled}this.opts={id:c,bizCompID:d,valueCheck:e,modalType:l,popupTitle:h,firstVal:i,disabled:f,codeVal:k,nameVal:j};this.drawDataSetting(this.opts)};a.prototype.drawDataSetting=function(c){this.draw(c)};a.prototype.draw=function(h){var g;h.jlampUUID=JLAMP.common.guid();if(h.id){g=b("#"+h.id)}else{if(h.object){g=b(h.object)}else{h.id=h.jlampUUID;g=b('<input type="text" id="'+h.jlampUUID+'">')}}var c="",j="";if(h.codeVal){c=g.attr("jlamp-pop-codeval")}if(h.nameVal){j=g.attr("jlamp-pop-nameval")}var i="",d="";if(h.codeOnly){d="display: block;"}g.removeClass().addClass("jlamp-modal-code");g.css("float","left");g.attr("jlamp-popcode","");g.attr("jlamp-uuid",h.jlampUUID);g.val(c);var f="";if(h.disabled){f="disabled='disabled'"}i+='<span class="input-group" style="'+d+'">';i+='  <input type="text" jlamp-pop-name="'+h.id+'_name" jlamp-popname jlamp-pop-modaltype="'+h.modalType+'" class="jlamp-modal-name" jlamp-uuid="'+h.jlampUUID+'" value="'+j+'" '+f+' style="border-left: 0">';i+='  <span class="input-group-btn">';i+='      <button jlamp-pop-name="'+h.id+'_search_btn" class="jlamp-modal-btn" type="button" jlamp-pop-modaltype="'+h.modalType+'" jlamp-uuid="'+h.jlampUUID+'"  '+f+">";i+='          <span><img jlamp-pop-name="'+h.id+'_search_btn_img" class="jlamp-modal-btn-image" src="/image/icon_new_window.png"></span>';i+="      </button>";i+="  </span>";i+="</span>";if(h.codeOnly){return g[0].outerHTML+i}else{g.parent().append(i)}g.parent().children("span").children("span").children("button").click(this.click);g.keypress(this.keypress);g.blur(this.blur);g.change(this.change);g.parent().children("span").children("input").keypress(this.keypress);g.parent().children("span").children("input").blur(this.blur);g.parent().children("span").children("input").change(this.change);if(g.attr("jlamp-pop-loadcallback")){var e=window[g.attr("jlamp-pop-loadcallback")];if(typeof e==="function"){e.apply(this,g)}}};a.prototype.getBizCompData=function(c){var k=b(c);var j=k.attr("jlamp-pop-modaltype");var f=b("#jlamp_"+j+" input[jlamp-pop-formcontrol]");var i=false;var h=true;var d=k.attr("bizcomponentid");var e={bizID:d};b.each(f,function(l){var n=b(this);var m=n.val();if(m&&n.attr("jlamp-pop-formoperator")){m+="|"+n.attr("jlamp-pop-formoperator")}if(n.attr("jlamp-required")!==undefined){if(m==""){alert("필수항목을 입력해 주십시오.");h=false;return h}}e[n.attr("jlamp-pop-formcontrol")]=m});if(!h){return}try{if(k[0].attributes.length>0){b.each(k[0].attributes,function(l){if(this.localName.substring(0,18)=="jlamp-pop-addwhere"){var m=this.value.split("||");if(m[2]==="false"&&b("#"+m[1]).val()===""){}else{e["__aw__"+m[0]]=b("#"+m[1]).val()}}})}}catch(g){console.log("JLAMP.modal - "+g);console.debug(new Error().stack)}try{b.ajax({url:"/JLAMPCommon/bizPopRows_prc",data:e,type:"get",dataType:"json",async:false,success:function(p,m,t){if(p){if(p.returnCode==0){if(p.data.code.length==1){if(c.prevObject&&c.prevObject.prop("nodeName").toLowerCase()=="span"){var n=p.data.code[0][p.data.fieldInfo[0].FieldName];var u=p.data.code[0][p.data.fieldInfo[1].FieldName];var s=b("#jlamp_"+j).attr("jlamp-uuid");var o=b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popcode][jlamp-uuid='"+s+"']");var l=false,r=false;if(b("#jlamp_"+j).attr("jlamp-pop-callback")){var q=window[b("#jlamp_"+j).attr("jlamp-pop-callback")];if(typeof q==="function"){q.apply(this,[JLAMP.modal.$parent,p.data.code[0]])}JLAMP.modal.isCallbackCalled=true}b.each(o[0].attributes,function(w){if(this.localName.substring(0,17).toLowerCase()=="jlamp-pop-select["){var v=this.localName.substring(17,this.localName.length-1);if(v==="code"){b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popcode][jlamp-uuid='"+s+"']").val(p.data.code[0][this.value]);b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popcode][jlamp-uuid='"+s+"']").attr("prevalue",p.data.code[0][this.value]);l=true}else{if(v==="name"){b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popname][jlamp-uuid='"+s+"']").val(p.data.code[0][this.value]);b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popname][jlamp-uuid='"+s+"']").attr("prevalue",p.data.code[0][this.value]);r=true}else{b("#"+v).val(p.data.code[0][this.value])}}}});if(!l){b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popcode][jlamp-uuid='"+s+"']").val(n);b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popcode][jlamp-uuid='"+s+"']").attr("prevalue",n)}if(!r){b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popname][jlamp-uuid='"+s+"']").val(u);b("input[jlamp-pop-modaltype='"+j+"'][jlamp-popname][jlamp-uuid='"+s+"']").attr("prevalue",u)}}i=true}JLAMP.modal.dataBinding(c,p.data)}else{}}},error:function(n,l,m){},complete:function(m,l){}})}catch(g){console.log(g)}return i};a.prototype.dataBinding=function(e,h){try{var o=b(e).attr("jlamp-pop-modaltype");var n=b(e).attr("jlamp-uuid");var m=b("#jlamp_"+o);var f=b("input[jlamp-pop-modaltype='"+o+"'][jlamp-uuid='"+n+"']");var d=b("#jlamp_"+f.attr("jlamp-pop-modaltype")+" [jlamp-pop-list]");d.html("");if(d){var l=[];var g=m.attr("jlamp-pop-format")?m.attr("jlamp-pop-format").split("&"):"";if(g){b.each(g,function(q){var s=this?this.split("="):"";var p=JLAMP.getCookie("SI");if(s&&p){var r=JSON.parse(p);l[s[0]]=r[s[1]]}})}var c=[];var j={};var i={};b.each(h.fieldInfo,function(){if(this.ColumnWidth>0){if(l[this.FieldName]){c.push({field:this.FieldName,title:this.FieldCaption,format:"{0:n"+l[this.FieldName]+"}",width:this.ColumnWidth+"px",headerAttributes:{style:"text-align: center"},attributes:{style:"text-align: "+this.DataAlignment}});i={type:"number"}}else{c.push({field:this.FieldName,title:this.FieldCaption,width:this.ColumnWidth+"px",headerAttributes:{style:"text-align: center"}});i={type:"string"}}}j[this.FieldName]=i});d.kendoGrid({dataSource:{data:h.code,schema:{model:{fields:j}}},columns:c,resizable:true,height:350,selectable:true,change:function(r){var s=this.dataItem(this.select());var z=this.element.attr("jlamp-pop-modaltype");var x=b("#jlamp_"+z).attr("jlamp-uuid");var q=s[this.columns[0].field];var y=s[this.columns[1].field];var t=b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popcode][jlamp-uuid='"+x+"']");var p=false,w=false;if(b("#jlamp_"+z).attr("jlamp-pop-callback")){JLAMP.modal.isCallbackCalled=true;var v=window[b("#jlamp_"+z).attr("jlamp-pop-callback")];if(typeof v==="function"){v.apply(this,[JLAMP.modal.$parent,s])}}if(!JLAMP.modal.isCallbackCalled){try{b.each(t[0].attributes,function(B){if(this.localName.substring(0,17).toLowerCase()=="jlamp-pop-select["){var A=this.localName.substring(17,this.localName.length-1);if(A==="code"){b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popcode][jlamp-uuid='"+x+"']").val(s[this.value]);b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popcode][jlamp-uuid='"+x+"']").attr("prevalue",s[this.value]);p=true}else{if(A==="name"){b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popname][jlamp-uuid='"+x+"']").val(s[this.value]);b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popname][jlamp-uuid='"+x+"']").attr("prevalue",s[this.value]);w=true}else{b("#"+A).val(s[this.value])}}}});if(!p){b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popcode][jlamp-uuid='"+x+"']").val(q);b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popcode][jlamp-uuid='"+x+"']").attr("prevalue",q)}if(!w){b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popname][jlamp-uuid='"+x+"']").val(y);b("input[jlamp-pop-modaltype='"+z+"'][jlamp-popname][jlamp-uuid='"+x+"']").attr("prevalue",y)}b("#jlamp_"+z+" [jlamp-popcode]").val("");b("#jlamp_"+z+" [jlamp-popname]").val("")}catch(u){}}b("#jlamp_"+z).modal("hide")}});b(d.selector+" .k-grid-content.k-auto-scrollable").css("height","320px")}}catch(k){console.log(k)}};a.prototype.click=function(m,k,o,i){JLAMP.modal.isClicked=true;if(i!=false||i!=0){i=true}var r,q;if(m instanceof jQuery.Event){r=b(m.currentTarget).parent().parent().siblings("input");q=b(this).attr("jlamp-pop-modaltype");if(r.attr("jlamp-pop-callback")){b("#jlamp_"+q).attr("jlamp-pop-callback",r.attr("jlamp-pop-callback"))}}else{r=b(k);JLAMP.modal.$object=r;JLAMP.modal.$parent=r.parent('td[role="gridcell"]');if(!r.attr("jlamp-uuid")){r.attr("jlamp-uuid",JLAMP.common.guid())}q=r.attr("jlamp-pop-modaltype");if(o){b("#jlamp_"+q).attr("jlamp-pop-callback",o.name)}}var n=r.attr("jlamp-uuid");b("#jlamp_"+q).attr("jlamp-uuid",n);b("#jlamp_"+q).attr("jlamp-pop-modaltype",q);b("#jlamp_"+q).attr("bizcomponentid",r.attr("bizcomponentid"));b("#jlamp_"+q).attr("jlamp-pop-format",r.attr("jlamp-pop-format"));try{if(r[0].attributes.length>0){b.each(r[0].attributes,function(e){if(this.localName.substring(0,18)=="jlamp-pop-addwhere"){b("#jlamp_"+q).attr(this.localName,this.value)}})}}catch(l){console.log("JLAMP.modal - "+l);console.debug(new Error().stack)}var g=b("input[jlamp-pop-modaltype='"+q+"'][jlamp-popcode][jlamp-uuid='"+n+"']");var f=b("input[jlamp-pop-modaltype='"+q+"'][jlamp-popname][jlamp-uuid='"+n+"']");if(g.val()==""||f.val()==""){g.val("");f.val("")}else{}var c={};var d;if(g.length){d=g}else{d=f}if(d.attr("jlamp-pop-set[evalyear]")){try{var h=b("#"+d.attr("jlamp-pop-set[evalyear]")).val();c={id:"jlamp_"+q+"evalyear",bizCompID:"L_HRE010",disabled:"disabled",value:h};setJLAMPLookup(c)}catch(l){console.log(l)}}if(d.attr("jlamp-pop-set[evalmonth]")){try{var j=b("#"+d.attr("jlamp-pop-set[evalmonth]")).val();c={id:"jlamp_"+q+"evalmonth",bizCompID:"L_HRE009",disabled:"disabled",value:j};setJLAMPLookup(c)}catch(l){console.log(l)}}if(d.attr("jlamp-pop-deptsearch")=="false"){b("tr[jlamp-role='dept']").hide()}else{b("tr[jlamp-role='dept']").show()}if(d.attr("jlamp-pop-worktypesearch")=="false"){b("tr[jlamp-role='worktype']").hide()}else{b("tr[jlamp-role='worktype']").show()}if(d.attr("jlamp-pop-basedatesearch")=="false"){b("tr[jlamp-role='basedate']").hide()}else{b("tr[jlamp-role='basedate']").show()}if(d.length>0){b.each(d[0].attributes,function(s){if(this.localName.substring(0,16)=="jlamp-pop-where["){var e=this.localName.substring(16,this.localName.length-1);b("#jlamp_"+q+" [jlamp-pop-formcontrol='"+e+"']").attr("jlamp-pop-formoperator",d.attr("jlamp-pop-where["+e+"]"))}})}b("#jlamp_"+q+" span[jlamp-pop-title]").text(r.attr("jlamp-pop-title"));if(r.attr("jlamp-pop-valcheck")!==undefined&&r.attr("jlamp-pop-valcheck")==="false"){if(i){JLAMP.modal.getBizCompData(r)}b("#jlamp_"+q).attr("jlamp-uuid",n);b("#jlamp_"+q+" [jlamp-pop-searchbtn]").attr("jlamp-uuid",n);b("#jlamp_"+q).modal("show")}else{if(m instanceof jQuery.Event&&m.isTrigger===undefined){b("#jlamp_"+q+" [jlamp-popcode]:not(input[jlamp-uuid])").val("");b("#jlamp_"+q+" [jlamp-popname]:not(input[jlamp-uuid])").val(f.val());if(i){JLAMP.modal.getBizCompData(r)}b("#jlamp_"+q).attr("jlamp-uuid",n);b("#jlamp_"+q+" [jlamp-pop-searchbtn]").attr("jlamp-uuid",n);b("#jlamp_"+q).modal("show")}else{var p=false;if(i){p=JLAMP.modal.getBizCompData(r)}if(!p){b("#jlamp_"+q).attr("jlamp-uuid",n);b("#jlamp_"+q+" [jlamp-pop-searchbtn]").attr("jlamp-uuid",n);b("#jlamp_"+q).modal("show")}else{JLAMP.modal.isClicked=false;b("#jlamp_"+q).removeAttr("jlamp-pop-format");b("#jlamp_"+q).removeAttr("jlamp-pop-callback")}}}};a.prototype.keypress=function(c){if(c.keyCode===13){this.blur()}};a.prototype.blur=function(k,g,m,f){if(JLAMP.modal.isClicked){return}if(f!=false||f!=0){f=true}var i,n,l;if(k instanceof jQuery.Event){i=b(this);l=b(this).attr("jlamp-uuid");n=i.attr("jlamp-pop-modaltype");var h=b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popcode][jlamp-uuid='"+l+"']");if(h.attr("jlamp-pop-callback")){b("#jlamp_"+n).attr("jlamp-pop-callback",h.attr("jlamp-pop-callback"))}}else{i=b(g);l=JLAMP.common.guid();i.attr("jlamp-uuid",l);n=i.attr("jlamp-pop-modaltype")}if(i.val()){if(i.attr("jlamp-popcode")!==undefined){var d=b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popcode][jlamp-uuid='"+l+"']");if(i.val()!=i.attr("prevalue")||d.val()!=d.attr("prevalue")){b("#jlamp_"+n+" [jlamp-popcode]:not(input[jlamp-uuid])").val(i.val());b("#jlamp_"+n+" [jlamp-popname]:not(input[jlamp-uuid])").val("");if(i.attr("jlamp-pop-valcheck")!==undefined&&i.attr("jlamp-pop-valcheck")==="false"){if(typeof m=="function"){JLAMP.modal.click(k,g,m,f)}else{b(this).siblings().children("span").children("button").click()}}else{if(typeof m=="function"){JLAMP.modal.click(k,g,m,f)}else{b(this).siblings().children("span").children("button").click()}}}}else{var c=b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popname][jlamp-uuid='"+l+"']");if(i.val()!=i.attr("prevalue")||c.val()!=c.attr("prevalue")){b("#jlamp_"+n+" [jlamp-popcode]:not(input[jlamp-uuid])").val("");b("#jlamp_"+n+" [jlamp-popname]:not(input[jlamp-uuid])").val(i.val());if(typeof m=="function"){JLAMP.modal.click(k,g,m,f)}else{b(this).siblings().children("button").click()}}}}else{if(typeof m=="function"){m(g)}else{if(h.attr("jlamp-pop-callback")){var j=window[h.attr("jlamp-pop-callback")];if(typeof j==="function"){j.apply(this,["",""])}}else{b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popcode][jlamp-uuid='"+l+"']").val("");b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popcode][jlamp-uuid='"+l+"']").attr("prevalue","");b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popname][jlamp-uuid='"+l+"']").val("");b("input[jlamp-pop-modaltype='"+n+"'][jlamp-popname][jlamp-uuid='"+l+"']").attr("prevalue","")}}}};a.prototype.hide=function(g){var i=b(this);var k=i.attr("jlamp-uuid");var l=i.attr("jlamp-pop-modaltype");var f=b("#"+i.attr("id")+" input[jlamp-pop-formcontrol]:not([jlamp-pop-formreset=false])");if(!JLAMP.modal.isCallbackCalled){var d=b("input[jlamp-popcode][jlamp-uuid='"+k+"']");var c=b("input[jlamp-popname][jlamp-uuid='"+k+"']");if((d.val()!=d.attr("prevalue"))||(c.val()!=c.attr("prevalue"))){d.val("");c.val("")}if(i.attr("jlamp-pop-callback")){var j=window[i.attr("jlamp-pop-callback")];if(typeof j==="function"){j.apply(this,["",""])}}}else{JLAMP.modal.isCallbackCalled=false}b.each(f,function(e){var m=b(this);m.val("");if(m.is("[jlamp-autobinding]")){m.removeAttr("jlamp-uuid");m.siblings("div").remove()}if(m.attr("jlamp-pop")!==undefined&&m.attr("jlamp-popcode")!==undefined){m.siblings("span").children("input").val("")}});i.removeAttr("jlamp-pop-format");i.removeAttr("jlamp-pop-callback");var h=b("#jlamp_"+i.attr("jlamp-pop-modaltype")+" [jlamp-pop-list]");h.children().remove();h.removeAttr("class");h.removeAttr("style");i.removeAttr("jlamp-uuid");JLAMP.modal.isClicked=false;JLAMP.autoBinding.makeAll()};a.prototype.hidden=function(c){if(b("div").hasClass("modal fade in")){b("body").addClass("modal-open")}};a.prototype.show=function(h){var d=b(h.currentTarget).attr("jlamp-uuid");var g=b(h.currentTarget).attr("jlamp-pop-modaltype");var c=b("input[jlamp-pop-modaltype='"+g+"'][jlamp-popcode][jlamp-uuid='"+d+"']");if(c.attr("jlamp-pop-callback")){b("#jlamp_"+g).attr("jlamp-pop-callback",c.attr("jlamp-pop-callback"))}b("#"+h.currentTarget.attributes.id.value+" input[jlamp-pop-searchbtn][jlamp-uuid='"+d+"']").off().click(function(k){var i=b(k.currentTarget).attr("jlamp-uuid");var j=b("div[jlamp-uuid='"+i+"']");JLAMP.modal.getBizCompData(j)});var f=b("#"+h.currentTarget.id+" [data-role='datepicker']").data("kendoDatePicker");if(f!=undefined){f.value(new Date())}};b(document).ready(function(){JLAMP.modal=new a();b.each(b("div[role='dialog']"),function(c){var d=b(this);if(d.attr("id").substring(0,10)==="jlamp_pop_"){d.on("show.bs.modal",JLAMP.modal.show);d.on("hide.bs.modal",JLAMP.modal.hide);d.on("hidden.bs.modal",JLAMP.modal.hidden)}})})})(jQuery);