var JLAMP=JLAMP||{};(function(b){var a=function(){this.version="2017.4.009";this.defaults={id:"",object:"",bizCompID:"",value:"",firstVal:"",whereQuery:"",addEmptyRow:false,bgColor:"#fff",showCode:false,disabled:false,codeVal:"",bindingField:"",isText:false,jlampUUID:""};this.bizComData={};this.keys={}};a.prototype.makeAll=function(){var d=this;b.each(b("[jlamp-autobinding]:not([jlamp-uuid])"),function(f){var g=b(this).attr("bizcomponentid");if(g){var e=b(this).attr("jlamp-ab-wherequery")?b(this).attr("jlamp-ab-wherequery").toString().trim():"";var h=g+"|"+e;if(!d.bizComData.hasOwnProperty(h)){d.keys[h]=""}d.make(b(this).attr("id"));b.each(b("tr[clicked='true']"),function(j){b(this).removeAttr("clicked");b(this).click()})}});if(Object.keys(this.keys).length){var c=JSON.stringify(Object.keys(this.keys));b.ajax({url:"/JLAMPCommon/bizCompBatchRows_prc",data:{kwq:c},type:"get",dataType:"json",async:false}).done(function(f,e,g){if(f){if(f.returnCode==0){if(f.data){d.bizComData=Object.assign(d.bizComData,f.data)}}else{alert(f.returnMsg)}}}).fail(function(g,e,f){console.log("ajax error - "+f)});this.keys={}}};a.prototype.make=function(c){var g=b("#"+c);var e=g.attr("bizcomponentid");var h=g.attr("jlamp-ab-firstval");var d=g.attr("jlamp-ab-wherequery");var j=g.attr("jlamp-ab-bgcolor");var k=g.attr("jlamp-ab-showcode");var i=g.attr("jlamp-ab-emptyrow");var f=g.attr("disabled");if(!d){d=""}if(i){if(i.toString().toLowerCase()=="y"||i.toString().toLowerCase()=="true"){i=true}else{i=false}}else{i=this.defaults.addEmptyRow}if(k){if(k.toString().toLowerCase()=="y"||k.toString().toLowerCase()=="true"){k=true}else{k=false}}else{k=this.defaults.showCode}if(f){f=true}else{f=this.defaults.disabled}this.opts={id:c,bizCompID:e,firstVal:h,whereQuery:d,addEmptyRow:i,bgColor:j,showCode:k,disabled:f};this.drawDataSetting(this.opts)};a.prototype.getBizCompData=function(g,c,e){var f=g+"|"+c;var d=this;if(e){if(typeof e.dataInit==="function"){e.dataInit.apply(e)}}b.ajax({url:"/JLAMPCommon/bizCompRows_prc",data:{bizID:g,expression:c},type:"get",dataType:"json",async:false}).done(function(i,h,j){if(i){if(i.returnCode==0){d.bizComData[f]=i}else{alert(i.returnMsg)}}}).fail(function(j,h,i){console.log("ajax error - "+i)}).always(function(i,h,j){if(e){if(typeof e.dataLoaded==="function"){e.dataLoaded.apply(this,[j,h])}}})};a.prototype.drawDataSetting=function(d){if(d.bizCompID){var e=d.bizCompID+"|"+d.whereQuery;if(!this.bizComData||!this.bizComData[e]){this.getBizCompData(d.bizCompID,d.whereQuery)}var c=this.bizComData[e]}this.draw(c,d)};a.prototype.draw=function(m,f){var q;if(f.id){q=b("#"+f.id)}else{if(f.object){q=b(f.object)}}f.jlampUUID=JLAMP.common.guid();if(f.value){q.val(f.value)}var z='onclick="JLAMP.autoBinding.dropdown(this)"';if(!f.firstVal){f.firstVal=""}if(f.disabled){f.bgColor="#f4f5f5";z=""}if(!f.bgColor){f.bgColor="#fff"}var y="";var w=0;if(m){if(m.returnCode==0){if(f.isText){var c="";for(w=0;w<m.data.code.length;w++){if(Object.keys(m.data.code[w]).length){c=Object.keys(m.data.code[w])[0];if(m.data.code[w][c]==f.codeVal){return m.data.code[w][f.bindingField]}}}return""}else{var d="";var l="";var e="";var o="";var v="";var h="";var A="";var n="";var u=0;var s=false;var g=0;var p=false;var t=0;q.attr("jlamp-uuid",f.jlampUUID);if(m.data.fieldInfo){b.each(jq(m.data.fieldInfo),function(j){if(this.ColumnWidth>0){t++}});g=m.data.fieldInfo.length;var k=new Array(g);var r=new Array(g);for(w=0;w<g;w++){if(w==0&&!f.showCode){t--}else{if(t<=1){p=true}if(m.data.fieldInfo[w].ColumnWidth>0){l+="<th>"+m.data.fieldInfo[w].FieldCaption+"</th>"}}k[w]=m.data.fieldInfo[w].FieldName;r[w]=m.data.fieldInfo[w].ColumnWidth}for(w=0;w<m.data.code.length;w++){if(w==0&&f.addEmptyRow){for(u=0;u<g;u++){if(u==0&&!f.showCode){}else{if(r[u]!=0){o+='<td style="background-color: inherit;"></td>'}}}e+='<tr clicked="true" onclick="JLAMP.autoBinding.click(\''+f.id+"', '', '', this, '')\">";e+=o;e+="</tr>";o=""}for(u=0;u<g;u++){h=m.data.code[w][k[u]];if(u==0&&!f.showCode){}else{if(r[u]!=0){o+='<td style="background-color: inherit;">'+h+"</td>"}}if(u==0){v=h;if(q.val()==v||f.firstVal==v){s=true}}else{if(u>0){if(u==1){n=h;if(s){f.firstVal=h}}A+="|"}}A+=h}v=v.replace(/'/g,"\\'").replace(/"/g,'\\"');A=A.replace(/'/g,"\\'").replace(/"/g,'\\"');n=n.replace(/'/g,"\\'").replace(/"/g,'\\"');if(s){q.attr("extval",A);s=false;var x="";b(e).each(function(){if(b(this).attr("clicked")){b(this).removeAttr("clicked")}x+=b(this)[0].outerHTML});if(x){e=x}e+='<tr clicked="true" onclick="JLAMP.autoBinding.click(\''+f.id+"', '"+v+"', '"+A+"', this, '"+n+"');\">"}else{if(w==0&&!q.val()&&!f.firstVal){if(f.addEmptyRow){e+="<tr onclick=\"JLAMP.autoBinding.click('"+f.id+"', '"+v+"', '"+A+"', this, '"+n+"')\">"}else{e+='<tr clicked="true" onclick="JLAMP.autoBinding.click(\''+f.id+"', '"+v+"', '"+A+"', this, '"+n+"')\">"}}else{e+="<tr onclick=\"JLAMP.autoBinding.click('"+f.id+"', '"+v+"', '"+A+"', this, '"+n+"')\">"}}e+=o;e+="</tr>";o="";v="";h="";A=""}b("#jlamp_ab_"+f.id).remove();y+='<div id="jlamp_ab_'+f.id+'" jlamp-uuid="'+f.jlampUUID+'" class="jlamp_ab_name"><div class="jlamp_ab_table_drop" style="display: block;"><button type="button" class="jlamp_ab_btn" style="background-color: '+f.bgColor+';" '+z+">"+f.firstVal+'&nbsp;<span class="fr"><img src="/image/dorp.png" alt=""></span></button></div>';y+='<table class="jlamp_ab_select_table" style="max-height: 300px; overflow: auto; display: none;" jlamp-ab-resize="'+p+'">';y+="<tbody>";y+="<tr>"+l+"</tr>";y+=e;y+="</body>";y+="</table>";y+="</div>";q.attr("style","display:none;");if(f.id){q.parent().append(y)}else{if(f.object){q.append(y)}else{return y}}}}}else{console.log(m)}}else{q.attr("jlamp-uuid",f.jlampUUID);q.addClass("input_100");b("#jlamp_ab_"+f.id).remove();q.css("display","block");q.css("background-color",f.bgColor);q.attr("readonly","readonly")}};a.prototype.dropdown=function(h){var f=b(h);var e=f.parent().width();var d=f.parent().siblings();var c=f.parent().parent().attr("jlamp-uuid");var i=b('[jlamp-autobinding][jlamp-uuid="'+c+'"]');if(i.attr("jlamp-ab-validation")){var g=window[i.attr("jlamp-ab-validation")];b.when(g()).then(function(j){if(d.attr("jlamp-ab-resize")=="true"){if(d.find("col").attr("width")){d.find("col").attr("width",e)}else{d.append('<colgroup><col width="'+e+'" /></colgroup>')}d.find("th:first").attr("width",e);d.width(e)}if(d.css("display")=="block"){d.css("display","none")}else{d.css("display","block")}},function(j){console.log("jlamp autobinding dropdown dfd reject")},function(j){})}else{if(d.attr("jlamp-ab-resize")=="true"){if(d.find("col").attr("width")){d.find("col").attr("width",e)}else{d.append('<colgroup><col width="'+e+'" /></colgroup>')}d.find("th:first").attr("width",e);d.width(e)}if(d.css("display")=="block"){d.css("display","none")}else{d.css("display","block")}}};a.prototype.click=function(g,e,c,f,d){b("#"+g).attr("preval",b("#"+g).val());b("#"+g).val(e).attr("extval",c);b(f).parent().parent().toggle();b(f).parent().parent().siblings().children().html(d+'&nbsp;<span class="fr"><img src="/image/dorp.png" alt=""></span>');if(b("#"+g).attr("onchange")){b("#"+g).change()}};b(document).ready(function(){JLAMP.autoBinding=new a()})})(jQuery);function setJLAMPLookup(b,a){if(!b.bizCompID){return}if(!b.whereQuery){b.whereQuery=""}if(a==undefined){jq("#"+b.id).val("");jq("#"+b.id).attr("extval","")}else{if(b.value!=jq(a).attr("preval")){jq("#"+b.id).val("")}}var c=b.bizCompID+"|"+b.whereQuery;if(!JLAMP.autoBinding.bizComData||!JLAMP.autoBinding.bizComData[c]){JLAMP.autoBinding.getBizCompData(b.bizCompID,b.whereQuery,b)}JLAMP.autoBinding.draw(JLAMP.autoBinding.bizComData[c],b);jq.each(jq("tr[clicked='true']"),function(d){jq(this).removeAttr("clicked");jq(this).click()})}function getJLAMPLookup(a){if(!a.bizCompID){return}if(!a.whereQuery){a.whereQuery=""}var b=a.bizCompID+"|"+a.whereQuery;if(!JLAMP.autoBinding.bizComData||!JLAMP.autoBinding.bizComData[b]){JLAMP.autoBinding.getBizCompData(a.bizCompID,a.whereQuery)}if(a.isText){return JLAMP.autoBinding.draw(JLAMP.autoBinding.bizComData[b],a)}else{return JLAMP.autoBinding.bizComData[b].data.code}}function delJLAMPBizData(c){for(var a in JLAMP.autoBinding.bizComData){try{if(a.split("|")[0]===c){delete JLAMP.autoBinding.bizComData[a]}}catch(b){console.debug(b)}}jq("[bizcomponentid='"+c+"']").each(function(e){var f=jq(this);var g=f.attr("id");var d=f.attr("jlamp-uuid");jq("#jlamp_ab_"+g).remove();jq("#"+g).val("");jq("#"+g).attr("preval","").attr("extval","");JLAMP.autoBinding.make(g)});jq.each(jq("tr[clicked='true']"),function(d){jq(this).click();jq(this).removeAttr("clicked")})}jq(document).click(function(a){if(a.target){if(!jq(a.target).hasClass("jlamp_ab_btn")){jq(".jlamp_ab_select_table").hide()}else{jq(".jlamp_ab_select_table").not(jq(a.target).parent().siblings(".jlamp_ab_select_table")).hide()}}});